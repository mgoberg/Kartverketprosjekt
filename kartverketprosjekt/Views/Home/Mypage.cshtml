@model List<kartverketprosjekt.Models.SakModel>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Min Side";
}

<a asp-controller="Home" asp-action="Index">
    <i class='bx bx-chevron-left'></i>
</a>
<h1>Min Side</h1>

<!-- Tilbakemeldinger -->
@if (TempData["SuccessMessage"] != null)
{
    <div style="color:green;">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div style="color:red;">@TempData["ErrorMessage"]</div>
}

<div class="box-container">
    <div class="instillinger">
 <h2>Kontoinstillinger </h2>
        <!-- Form for Updating Name -->
        <form asp-controller="Bruker" asp-action="UpdateName" method="post" style="margin-top: 20px;">
            @Html.AntiForgeryToken() <!-- Ensure this is included for security -->
            <div>
                <label for="Navn">All logikk for å endre navn i databasen ligger her: (Skal vi bare bruke denne for administratorer kanskje? Trenger brukere egentlig navn?)</label>
                <input type="text" id="Navn" name="navn" placeholder="Skriv inn nytt navn" required />
            </div>
            <button type="submit">Oppdater Navn</button>
        </form>
        <!-- Endre Passord Form -->
        <form asp-controller="Bruker" asp-action="UpdatePassword" method="post" style="margin-top: 0px;">
            @Html.AntiForgeryToken()
            <div>
                <label for="Password">Nytt passord:</label>
                <input type="password" id="Password" name="Password" placeholder="Skriv inn nytt passord" required />
            </div>
            <button type="submit">Oppdater Passord</button>
        </form>

        <!-- Slette Konto Form -->

        <form method="post" action="/Bruker/DeleteUser">
            <input type="password" name="passord" placeholder="Skriv inn passord" required />
            <button type="submit">Slett bruker</button>
        </form>
    </div>
    <script>
        document.getElementById("deleteUserButton").onclick = function () {
            // Ask for password input
            const password = prompt("Vennligst skriv inn passordet ditt for å bekrefte sletting:");

            if (password) {
                // Send delete request
                fetch('/Bruker/DeleteUser', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ passord: password })
                })
                    .then(response => {
                        if (response.ok) {
                            alert("Brukeren er slettet.");
                            window.location.href = '/Home/Index'; // Redirect to desired page after deletion
                        } else {
                            alert("Det oppstod en feil. Vennligst sjekk passordet og prøv igjen.");
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert("En feil oppstod. Vennligst prøv igjen senere.");
                    });
            }
        };
    </script>

    <div class="box">
        <h2>Oversikt over dine saker</h2>
        @if (Model != null && Model.Count > 0)
        {
            <ul>
                @foreach (var sak in Model)
                {
                    <li>
                        <strong>@sak.Kommunenavn</strong> -
                        Status: @sak.status -
                        Opprettet: @sak.opprettet_dato.ToString("d")
                        
                    </li>
                }
            </ul>
        }
        else
        {
            <p>Du har ingen saker.</p>
        }
    </div>

</div>
